<!-- Filter bar -->
<div class="jumbotron col-sm-6 col-sm">
  <%= form_tag '/map', :method => 'get' do %>

    <div class="form-group">
      <%= label_tag :sport %>
      <%= select_tag :sport_id, options_from_collection_for_select(
      Sport.all, :id, :name), class: 'form-control' %>
    </div>
    <div class="form-group">
      <%= label_tag :day %>
      <%= date_field_tag :day, Date.today %>
    </div>
    <%= submit_tag 'Search', class: 'btn btn-primary' %>
  <% end %>
</div>

<div class="container-fluid centered">
  <div id="map"></div>
</div>

<script type="text/javascript">
// NOTE:
// I think the map loads at lat:0, lng:0, which is the
//   middle of the Gulf of Guinea.
// To speed this up, I hardcoded Vancouver's coords.  This is something
//  we should change eventually, but I'm going to leave it for now.
  let handler = Gmaps.build('Google');
  handler.buildMap( { internal: {id: 'map'} }, () => {
    // Hardcoded co-ordinates for Vancouver for speed
    handler.map.centerOn({ lat: 49.28, lng: -123.1 });
    // This code centers on user's location but takes a while
    //  if (navigator.geolocation) {
    //    navigator.geolocation.getCurrentPosition(displayOnMap);
    //  }
    markers = handler.addMarkers(<%=raw @venue_markers.to_json %>);
    handler.getMap().setZoom(12);
  });


// Not used currently
  // function displayOnMap(position) {
  //   let marker = {
  //     lat: position.coords.latitude,
  //     lng: position.coords.longitude
  //   };
  //   handler.map.centerOn(marker);
  // };
</script>
    <div class="venues">
    <%= render @venues %>
    </div>
